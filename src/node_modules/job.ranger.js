// const job = {
//   type: 'ranger',
//   creep: 'creepname',
//   flag: 'flagname'
// }

module.exports = {
  getCreepBody: (room, job) => [RANGED_ATTACK, MOVE],
  execute: (creep, job) => {
    var position = Game.flags[job.flag].pos

    // if (creep.pos.roomName !== position.roomName) {
    //   creep.say('Ranger')
    //   console.log(`[${job.type} ${creep.name}] Moving into position ${creep.pos.roomName} --> ${position.roomName}`)
    //   creep.moveTo(position)
    //   return
    // }

    // var target = creep.pos.findClosestByRange(FIND_HOSTILE_CREEPS)
    // if (target) {
    //   creep.rangedAttack(target)
    // }
    // creep.rangedMassAttack()
    // creep.moveTo(position)

    var target
    if (creep.memory.target) {
      target = Game.getObjectById(creep.memory.target)
    }

    if (!target) {
      target = creep.pos.findInRange(FIND_HOSTILE_CREEPS, 3)[0]
    }

    if (!target) {
      target = creep.pos.findClosestByRange(FIND_HOSTILE_STRUCTURES, {
        filter: structure => structure.hitsMax && structure.hitsMax > 0
      })
    }

    if (target) {
      creep.memory.target = target.id
      creep.rangedMassAttack()
      // if (creep.rangedAttack(target) === ERR_NOT_IN_RANGE) {
      //   creep.moveTo(target)
      // }
      return
    }

    creep.moveTo(position)
  }
}
