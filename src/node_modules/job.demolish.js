// const job = {
//   type: 'demolish',
//   creep: 'creepname',
//   flag: 'flagname'
// }

module.exports = {
  getCreepBody: (room, job) => [TOUGH, TOUGH, MOVE, MOVE, MOVE, RANGED_ATTACK, RANGED_ATTACK, MOVE],
  execute: (creep, job) => {
    var position = Game.flags[job.flag].pos

    if (creep.pos.roomName !== position.roomName) {
      console.log(`[${job.type} ${creep.name}] Moving into position ${creep.pos.roomName} --> ${position.roomName}`)
      creep.moveTo(position)
      return
    }

    var target
    if (creep.memory.target) {
      target = Game.getObjectById(creep.memory.target)
    }

    if (!target) {
      target = creep.pos.findClosestByRange(FIND_HOSTILE_SPAWNS)
    }

    if (!target) {
      target = creep.pos.findClosestByRange(FIND_HOSTILE_STRUCTURES, {
        filter: structure => structure.hitsMax && structure.hitsMax > 0
      })
    }

    if (target) {
      creep.memory.target = target.id
      if (creep.dismantle(target) === ERR_NOT_IN_RANGE) {
        creep.moveTo(target)
      }
      return
    }

    creep.moveTo(position)
  }
}
