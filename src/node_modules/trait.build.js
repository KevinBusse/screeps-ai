var filters = require('filters')

/**
 * Claim trait - will look for a flag named NextRoom
 *
 * @param {Creep} creep
 * @returns {boolean}
 */
module.exports = (creep) => {
  _.reduce([
    STRUCTURE_SPAWN,
    STRUCTURE_EXTENSION,
    STRUCTURE_CONTAINER,
    STRUCTURE_WALL,
    STRUCTURE_RAMPART,
    STRUCTURE_WALL
  ], (type, busy) => {
    if (busy) {
      return true
    }

    var target = creep.pos.findClosestByRange(FIND_CONSTRUCTION_SITES, {
      filter: structure => structure.structureType === type
    })

    if (!target) {
      return false
    }

    // Try to build.
    switch (creep.build(target)) {
      // When not in range try to move closer.
      case ERR_NOT_IN_RANGE:
        var moveStatus = creep.moveTo(target)
        return (moveStatus === OK) || (moveStatus = ERR_TIRED)
      // Creep is building.
      case OK:
        return true
      // Something other error, so we didn't assign a task after all.
      default:
        return false
    }
  }, false)
}
