module.exports = {

  spawn: function(desired) {
    var spawnPoint =  Game.spawns[Object.keys(Game.spawns)[0]];
    var active =   _.filter(Game.creeps, (creep) => creep.memory.role === 'digger');
    var energyShare = Math.floor(0.8 * spawnPoint.room.energyCapacityAvailable);



    if (active.length < desired ) {
      if (spawnPoint.room.energyAvailable < energyShare ) {
        return false;
      }

      //Calculate remaining energy for WORK genes
      let maxWork = Math.floor((spawnPoint.room.energyAvailable - 50 ) / 100);
      let dna = [MOVE]; // Move 50, WORK 100


      while(maxWork--)
      {
        dna.push(WORK);
      }
      let newCreep = spawnPoint.createCreep(dna, '', {role: 'digger'});
      console.log('SPAWN DIGGER '+JSON.stringify(dna)+' '+newCreep );
      return true;
    }
    return false;

  },

  /** @param {Creep} creep **/
  run: function (creep) {


    if (!creep.memory.sourceId) {
      creep.memory.sourceId = creep.pos.findClosestByRange(FIND_SOURCES_ACTIVE).id;
    }



    var source = Game.getObjectById(creep.memory.sourceId);
    if (!source) {
      return console.log('Failed to locate source '+creep.memory.sourceId);
    }

    if (creep.harvest(source) === ERR_NOT_IN_RANGE) {
      creep.moveTo(source);
    }

  }
};