const ActionNode = require('tree.node.action')

class Dismantle extends ActionNode {
  tick (context) {
    var creep = context.actor

    if (!this.params.id) {
      this.log(context, 'No id provided for object to dismantle')
      return FAILURE
    }

    var roomObject = Game.getObjectById(this.params.id)
    if (!roomObject) {
      this.log(context, 'Object is already dismantled')
      return FAILURE
    }

    this.log(context, `Dismantling structure ${this.params.id}`)
    console.log(creep.dismantle(roomObject))

    let result = creep.dismantle(roomObject)
    if (result === ERR_NOT_IN_RANGE) {
      this.log(context, '... oops, not in range yet, moving closer')
      result = creep.moveTo(roomObject)
    }

    if (result === OK) {
      return RUNNING
    }

    this.log(context, '... oops, not in range yet, moving closer')
    return FAILURE
  }
}

module.exports = Dismantle
