var filters = require('filters')

/**
 *
 * @param {Room} room
 * @param {Object[]} options
 * @param {string} options.layout
 * @param {function} options.condition
 * @returns {Boolean}
 */
module.exports = (room, options) => {
  var towers = room.find(FIND_MY_STRUCTURES, {filter: structure => structure.type === STRUCTURE_TOWER})
  _.each(towers, tower => {
    /** @var {Tower} tower */
    // Find closest enemy.
    // TODO: detect healer / low hp creeps
    var closestHostile = tower.pos.findClosestByRange(FIND_HOSTILE_CREEPS)

    if (closestHostile) {
      tower.attack(closestHostile)
      return
    }

    // TODO: check for max energy, don't waste energy on repairs
    var closestDamagedStructure = tower.pos.findClosestByRange(FIND_STRUCTURES, {filter: filters.needsRepair})
    if (closestDamagedStructure) {
      tower.repair(closestDamagedStructure)
    }

    return false
  })
}
